<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title>Tickets: <%= controller.action_name %></title>
	<!-- <%= javascript_include_tag 'jquery', 'application' %>
  <%= stylesheet_link_tag 'scaffold' %> -->
	<script type="text/javascript" src="javascripts/jquery-1.3.2.min.js"></script> 
	<script type="text/javascript" src="javascripts/jquery.ui-edited.js"></script>

	<link rel='stylesheet' href='stylesheets/styles.css' type='text/css' media='all' />

	<script type="text/javascript" charset="utf-8">
		//var AUTH_TOKEN = "<%= protect_against_forgery? ? form_authenticity_token : '' %>";
		//$.ajaxSetup({data:{authenticity_token : AUTH_TOKEN}});
		$(function() {

			$('.ticket_list').selectable({
				autoRefresh: false,
				stop: function(e,ui){
					$(this).selectable( 'refresh');
				},
				noConflict : true
			});

			$('.ticket_list').sortable({
				cursor: 'crosshair',
		    connectWith: $('.ticket_list'),
				receive: function(event, ui) {
					$.ajax({
					  type: "PUT",
					  url: "/tickets/" + ui.item.attr('id') + ".js",
					  data: { assigned_user_id : this.id },
					  dataType: 'json'
					});
				}
			});

			
			$('.ticket_list > li > a').click(function() {
				alert('HI');
				$.ajax({
				  type: "PUT",
				  url: "/tickets/" +$(this).parents("li:first").attr('id') + ".js",
				  data: { state : 'resolved' },
				  dataType: 'json'
				});
			  $(this).parents("li:first").remove();
			
			  $('.ticket_list').sortable('refresh');
			});
		});
	</script>

</head>
<body>

<p style="color: green"><%= flash[:notice] %></p>

<%= yield  %>

</body>
</html>
